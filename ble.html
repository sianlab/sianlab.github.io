<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>안드로이드 BLE 통신</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />

    <!-- custom.css -->
    <link rel="stylesheet" type="text/css" href="/assets/built/custom.css" />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- 웹폰트 추가 -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/nanumgothic.css">

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="기술 블로그" />
    <link rel="shortcut icon" href="https://simplehanlab.github.io/assets/built/images/favicon.jpg" type="image/png" />
    <link rel="canonical" href="https://simplehanlab.github.io/ble" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="SimpleHan Lab" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="안드로이드 BLE 통신" />
    <meta property="og:description" content="1. 블루투스 권한 설정 안드로이드에서 BLE 통신을 사용하기 위해서는 APP 이 특정 권한들을 획득해야 한다. 아래와 같이 AndroidManifast.xml 파일에 권한 코드를 추가한다. &lt;uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION"/&gt; &lt;uses-permission android:name="android.permission.BLUETOOTH"/&gt; &lt;uses-permission android:name="android.permission.BLUETOOTH_ADMIN"/&gt; BLE 통신을 위해 BLUETOOTH, BLUETOOTH_ADMIN 권한 외에 ACCESS_COARSE_LOCATION라는 위치 권한도 필요하다. BLE 장치가 위치 정보를 제공하는 것이 많기 때문에 구글에서 위치 권한도" />
    <meta property="og:url" content="https://simplehanlab.github.io/ble" />
    <meta property="og:image" content="https://simplehanlab.github.io/assets/built/images/react/react-logo.png" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2019-11-11T17:35:00+00:00" />
    <meta property="article:modified_time" content="2019-11-11T17:35:00+00:00" />
    <meta property="article:tag" content="javascript" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="안드로이드 BLE 통신" />
    <meta name="twitter:description" content="1. 블루투스 권한 설정 안드로이드에서 BLE 통신을 사용하기 위해서는 APP 이 특정 권한들을 획득해야 한다. 아래와 같이 AndroidManifast.xml 파일에 권한 코드를 추가한다. &lt;uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION"/&gt; &lt;uses-permission android:name="android.permission.BLUETOOTH"/&gt; &lt;uses-permission android:name="android.permission.BLUETOOTH_ADMIN"/&gt; BLE 통신을 위해 BLUETOOTH, BLUETOOTH_ADMIN 권한 외에 ACCESS_COARSE_LOCATION라는 위치 권한도 필요하다. BLE 장치가 위치 정보를 제공하는 것이 많기 때문에 구글에서 위치 권한도" />
    <meta name="twitter:url" content="https://simplehanlab.github.io/" />
    <meta name="twitter:image" content="https://simplehanlab.github.io/assets/built/images/react/react-logo.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="SimpleHan Lab" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="javascript" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "SimpleHan Lab",
        "logo": "https://simplehanlab.github.io/"
    },
    "url": "https://simplehanlab.github.io/ble",
    "image": {
        "@type": "ImageObject",
        "url": "https://simplehanlab.github.io/assets/built/images/react/react-logo.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://simplehanlab.github.io/ble"
    },
    "description": "1. 블루투스 권한 설정 안드로이드에서 BLE 통신을 사용하기 위해서는 APP 이 특정 권한들을 획득해야 한다. 아래와 같이 AndroidManifast.xml 파일에 권한 코드를 추가한다. &lt;uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION"/&gt; &lt;uses-permission android:name="android.permission.BLUETOOTH"/&gt; &lt;uses-permission android:name="android.permission.BLUETOOTH_ADMIN"/&gt; BLE 통신을 위해 BLUETOOTH, BLUETOOTH_ADMIN 권한 외에 ACCESS_COARSE_LOCATION라는 위치 권한도 필요하다. BLE 장치가 위치 정보를 제공하는 것이 많기 때문에 구글에서 위치 권한도"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="안드로이드 BLE 통신" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://simplehanlab.github.io/">SimpleHan Lab</a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
    <li class="nav-jekyll" role="menuitem"><a href="/category/react/">react</a></li>
    <li class="nav-python" role="menuitem"><a href="/category/spring/">spring</a></li>
    <li class="nav-java" role="menuitem"><a href="/category/ios/">ios</a></li>
    <li class="nav-jekyll" role="menuitem"><a href="/category/jekyll/">jekyll</a></li>
    <li class="nav-python" role="menuitem"><a href="/category/minimal-mistakes/">minimal-mistakes</a></li>
    <li class="nav-python" role="menuitem"><a href="/category/ssl/">ssl</a></li>
    <li class="nav-python" role="menuitem"><a href="/category/tensorflow/">tensorflow</a></li>
    <li class="nav-python" role="menuitem"><a href="/category/ssh/">ssh</a></li>
    <li class="nav-archive" role="menuitem">
        <a href="/archive.html">All Posts</a>
    </li>
    <li class="nav-archive" role="menuitem">
        <a href="/categories.html">카테고리별 Posts</a>
    </li>
    <li class="nav-archive" role="menuitem">
        <a href="/author_archive.html">Tag별 Posts</a>
    </li>
</ul>
        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
            <a class="subscribe-button" href="#subscribe">Search</a>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-javascript tag-react tag-node tag-google tag-map  ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="11 November 2019">11 November 2019</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                            <a href='/category/react/'>REACT</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">안드로이드 BLE 통신</h1>
            </header>

            <!--
            
            <figure class="post-full-image" style="background-image: url(/assets/built/images/react/react-logo.png)">
            </figure>
            
            -->

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <h3 id="1-블루투스-권한-설정">1. 블루투스 권한 설정</h3>

<p>안드로이드에서 BLE 통신을 사용하기 위해서는</p>

<p>APP 이 특정 권한들을 획득해야 한다.</p>

<p>아래와 같이 AndroidManifast.xml 파일에 권한 코드를 추가한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="o">&lt;</span><span class="n">uses</span><span class="o">-</span><span class="n">permission</span> <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">"android.permission.ACCESS_COARSE_LOCATION"</span><span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="n">uses</span><span class="o">-</span><span class="n">permission</span> <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">"android.permission.BLUETOOTH"</span><span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="n">uses</span><span class="o">-</span><span class="n">permission</span> <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">"android.permission.BLUETOOTH_ADMIN"</span><span class="o">/&gt;</span>
</code></pre></div></div>

<p>BLE 통신을 위해 BLUETOOTH, BLUETOOTH_ADMIN 권한 외에</p>

<p>ACCESS_COARSE_LOCATION라는 위치 권한도 필요하다.</p>

<p>BLE 장치가 위치 정보를 제공하는 것이 많기 때문에</p>

<p>구글에서 위치 권한도 요청하기로 했다고 한다.</p>

<p>안드로이드 마시멜로 버전 이상부터는</p>

<p>사용자에게 요청하여 권한을 획득해야 한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">// OS 버전이 마시멜로 이상이라면 위치 권한이 있는지 점검 후 없다면 사용자에게 위치 권한을 요청</span>
  <span class="k">if</span> <span class="o">(</span><span class="nc">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">SDK_INT</span> <span class="o">&gt;=</span> <span class="nc">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">M</span><span class="o">)</span> <span class="o">{</span>
      
      <span class="c1">// 위치 권한이 있는지 점검</span>
      <span class="c1">// 없다면 -1 반환</span>
      <span class="kt">int</span> <span class="n">permission</span> <span class="o">=</span> <span class="n">checkSelfPermission</span><span class="o">(</span><span class="n">android</span><span class="o">.</span><span class="na">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">ACCESS_COARSE_LOCATION</span><span class="o">);</span>

      <span class="c1">// 권한이 없을 때</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">permission</span> <span class="o">==</span> <span class="nc">PackageManager</span><span class="o">.</span><span class="na">PERMISSION_DENIED</span><span class="o">)</span>
      <span class="o">{</span>
          <span class="nc">String</span><span class="o">[]</span> <span class="n">permissions</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
          <span class="n">permissions</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="n">android</span><span class="o">.</span><span class="na">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">ACCESS_COARSE_LOCATION</span><span class="o">;</span> <span class="c1">// 사용자에게 요청할 권한</span>
          <span class="n">requestPermissions</span><span class="o">(</span><span class="n">permissions</span><span class="o">,</span> <span class="no">LOCATION_PERMISSION_REQUEST_CODE</span><span class="o">);</span> <span class="c1">// 사용자에게 권한 요청</span>
      <span class="o">}</span>
      <span class="c1">// 권한이 있을 때</span>
      <span class="k">else</span>
      <span class="o">{</span>
          <span class="c1">// 변수 값을 true 로 변경</span>
          <span class="n">isPermissionAllowed</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></div></div>

<p>권한을 요청한 후 사용자의 응답에 따라</p>

<p>처리가 가능하도록 메서드를 추가한다.</p>

<p>본 예제는 권한을 득하면 바로 주변의</p>

<p>BLE 기기를 스캐닝 하도록 구성되어 있다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">// 사용자에게 권한을 요청한 결과가 들어오는 메소드</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onRequestPermissionsResult</span><span class="o">(</span><span class="kt">int</span> <span class="n">requestCode</span><span class="o">,</span> <span class="nc">String</span> <span class="n">permissions</span><span class="o">[],</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">grantResults</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// 위치 권한 요청의 응답값인지 체크</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">requestCode</span> <span class="o">==</span> <span class="no">LOCATION_PERMISSION_REQUEST_CODE</span><span class="o">)</span> <span class="o">{</span>
          <span class="c1">// 권한을 획득</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">grantResults</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">==</span> <span class="nc">PackageManager</span><span class="o">.</span><span class="na">PERMISSION_GRANTED</span><span class="o">)</span>
          <span class="o">{</span>
              <span class="c1">// BLE 스캐닝</span>
              <span class="n">scanLeDevice</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
          <span class="o">}</span>
          <span class="c1">// 권한 획득 실패</span>
          <span class="k">else</span>
          <span class="o">{</span>
              <span class="nc">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="no">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">error_permission_denied</span><span class="o">,</span> <span class="nc">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">);</span>
              <span class="n">finish</span><span class="o">();</span>
          <span class="o">}</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></div></div>

<h3 id="2-ble-scan">2. BLE SCAN</h3>

<p>BLE 스캐닝 시 배터리 소모가 극심하기 때문에</p>

<p>로직을 구현할 때 두가지 권고사항이 있다.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1.원하는 기기 발견 시, 스캐닝 중지

2.스캐닝을 루프시키지 말 것.
</code></pre></div></div>

<p>위의 두 가지 사항에 따라 설정한 시간이</p>

<p>지난 후 스캐닝 후 중지되도록 구현해야 한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">scanLeDevice</span><span class="o">(</span><span class="kd">final</span> <span class="kt">boolean</span> <span class="n">enable</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">enable</span><span class="o">)</span> <span class="o">{</span>
          <span class="c1">// SCAN_PERIOD 값만큼 시간이 지나면 스캐닝 중지</span>
          <span class="n">mHandler</span><span class="o">.</span><span class="na">postDelayed</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
              <span class="nd">@Override</span>
              <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                  <span class="n">mScanning</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
                  <span class="n">stopScanBLE</span><span class="o">();</span>
                  <span class="n">invalidateOptionsMenu</span><span class="o">();</span>
              <span class="o">}</span>
          <span class="o">},</span> <span class="no">SCAN_PERIOD</span><span class="o">);</span>

          <span class="n">mScanning</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
          <span class="n">startScanBLE</span><span class="o">();</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
          <span class="n">mScanning</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
          <span class="n">stopScanBLE</span><span class="o">();</span>
      <span class="o">}</span>
      <span class="n">invalidateOptionsMenu</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="c1">// BLE 스캔시작</span>
  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">startScanBLE</span><span class="o">(){</span>
      <span class="k">if</span> <span class="o">(</span><span class="nc">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">SDK_INT</span> <span class="o">&gt;=</span> <span class="nc">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">LOLLIPOP</span><span class="o">)</span>
      <span class="o">{</span>
          <span class="n">mBluetoothAdapter</span><span class="o">.</span><span class="na">getBluetoothLeScanner</span><span class="o">().</span><span class="na">startScan</span><span class="o">(</span><span class="n">mScanCallback</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="k">else</span>
      <span class="o">{</span>
          <span class="n">mBluetoothAdapter</span><span class="o">.</span><span class="na">startLeScan</span><span class="o">(</span><span class="n">mLeScanCallback</span><span class="o">);</span>
      <span class="o">}</span>
  <span class="o">}</span>

  <span class="c1">// BLE 스캔중지</span>
  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">stopScanBLE</span><span class="o">(){</span>
      <span class="k">if</span> <span class="o">(</span><span class="nc">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">SDK_INT</span> <span class="o">&gt;=</span> <span class="nc">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">LOLLIPOP</span><span class="o">)</span>
      <span class="o">{</span>
          <span class="n">mBluetoothAdapter</span><span class="o">.</span><span class="na">getBluetoothLeScanner</span><span class="o">().</span><span class="na">stopScan</span><span class="o">(</span><span class="n">mScanCallback</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="k">else</span>
      <span class="o">{</span>
          <span class="n">mBluetoothAdapter</span><span class="o">.</span><span class="na">stopLeScan</span><span class="o">(</span><span class="n">mLeScanCallback</span><span class="o">);</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></div></div>

<p>BLE 기기가 스캔되면 콜백함수가 호출된다.</p>

<p>여기서 찾은 기기를 리스트 객체에 추가하고, 화면을 갱신한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">// BLE 기기가 스캔되면 호출. 롤리팝 이하 버전</span>
  <span class="kd">private</span> <span class="nc">BluetoothAdapter</span><span class="o">.</span><span class="na">LeScanCallback</span> <span class="n">mLeScanCallback</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BluetoothAdapter</span><span class="o">.</span><span class="na">LeScanCallback</span><span class="o">()</span> <span class="o">{</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onLeScan</span><span class="o">(</span><span class="kd">final</span> <span class="nc">BluetoothDevice</span> <span class="n">device</span><span class="o">,</span> <span class="kt">int</span> <span class="n">rssi</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">scanRecord</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">runOnUiThread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
              <span class="nd">@Override</span>
              <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                  <span class="n">mLeDeviceListAdapter</span><span class="o">.</span><span class="na">addDevice</span><span class="o">(</span><span class="n">device</span><span class="o">);</span>
                  <span class="n">mLeDeviceListAdapter</span><span class="o">.</span><span class="na">notifyDataSetChanged</span><span class="o">();</span>
              <span class="o">}</span>
          <span class="o">});</span>
      <span class="o">}</span>
  <span class="o">};</span>

  <span class="c1">// BLE 기기가 스캔되면 호출. 롤리팝 이상 버전</span>
  <span class="kd">private</span> <span class="nc">ScanCallback</span> <span class="n">mScanCallback</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ScanCallback</span><span class="o">()</span> <span class="o">{</span>
      <span class="nd">@RequiresApi</span><span class="o">(</span><span class="n">api</span> <span class="o">=</span> <span class="nc">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">LOLLIPOP</span><span class="o">)</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onScanResult</span><span class="o">(</span><span class="kt">int</span> <span class="n">callbackType</span><span class="o">,</span> <span class="nc">ScanResult</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
          <span class="kd">super</span><span class="o">.</span><span class="na">onScanResult</span><span class="o">(</span><span class="n">callbackType</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>

          <span class="nc">BluetoothDevice</span> <span class="n">device</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">getDevice</span><span class="o">();</span>
          <span class="n">mLeDeviceListAdapter</span><span class="o">.</span><span class="na">addDevice</span><span class="o">(</span><span class="n">device</span><span class="o">);</span>
          <span class="n">mLeDeviceListAdapter</span><span class="o">.</span><span class="na">notifyDataSetChanged</span><span class="o">();</span>
      <span class="o">}</span>
  <span class="o">};</span>
</code></pre></div></div>

<h3 id="3-ble-connect">3. BLE CONNECT</h3>

<p>검색된 BLE 리스트에서 특정 기기를 선택하면</p>

<p>mBluetoothLeService 의 connect 메소드를</p>

<p>호출하여 기기에 연결을 시도한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">private</span> <span class="nc">BluetoothGatt</span> <span class="n">mBluetoothGatt</span><span class="o">;</span>

  <span class="kd">private</span> <span class="nc">BluetoothGattCharacteristic</span> <span class="n">mReadCharacteristic</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
  <span class="kd">private</span> <span class="nc">BluetoothGattCharacteristic</span> <span class="n">mWriteCharateristic</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">SERVICE</span> <span class="o">=</span> <span class="s">"0000fff0-0000-1000-8000-00805f9b34fb"</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">WRITE_UUID</span> <span class="o">=</span> <span class="s">"0000fff1-0000-1000-8000-00805f9b34fb"</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">READ_UUID</span> <span class="o">=</span> <span class="s">"0000fff2-0000-1000-8000-00805f9b34fb"</span><span class="o">;</span>

  <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">findGattServices</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">BluetoothGattService</span><span class="o">&gt;</span> <span class="n">gattServices</span> <span class="o">=</span> <span class="n">mBluetoothGatt</span><span class="o">.</span><span class="na">getServices</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">gattServices</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>

    <span class="n">mReadCharacteristic</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="n">mWriteCharateristic</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="k">for</span> <span class="o">(</span><span class="nc">BluetoothGattService</span> <span class="n">gattService</span> <span class="o">:</span> <span class="n">gattServices</span><span class="o">){</span>
      <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">currentServiceData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;();</span>

      <span class="k">if</span><span class="o">(</span><span class="n">gattService</span><span class="o">.</span><span class="na">getUuid</span><span class="o">().</span><span class="na">toString</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="no">SERVICE</span><span class="o">)){</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">BluetoothGattCharacteristic</span><span class="o">&gt;</span> <span class="n">gattCharacteristics</span> <span class="o">=</span> <span class="n">gattService</span><span class="o">.</span><span class="na">getCharacteristics</span><span class="o">();</span>

        <span class="c1">// Loops through available Characteristics.</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">BluetoothGattCharacteristic</span> <span class="n">gattCharacteristic</span> <span class="o">:</span> <span class="n">gattCharacteristics</span><span class="o">){</span>
          <span class="k">if</span><span class="o">(</span><span class="n">gattCharacteristic</span><span class="o">.</span><span class="na">getUuid</span><span class="o">().</span><span class="na">toString</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="no">READ_UUID</span><span class="o">)){</span>
            <span class="kd">final</span> <span class="kt">int</span> <span class="n">charaProp</span> <span class="o">=</span> <span class="n">gattCharacteristic</span><span class="o">.</span><span class="na">getProperties</span><span class="o">();</span>

            <span class="k">if</span><span class="o">((</span><span class="n">charaProp</span> <span class="o">|</span> <span class="nc">BluetoothGattCharacteristic</span><span class="o">.</span><span class="na">PROPERTY_NOTIFY</span><span class="o">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">){</span>
              <span class="k">try</span><span class="o">{</span>
                <span class="n">mReadCharacteristic</span> <span class="o">=</span> <span class="n">gattCharacteristic</span><span class="o">;</span>
                <span class="nc">List</span><span class="o">&lt;</span><span class="nc">BluetoothGattDescriptor</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">mReadCharacteristic</span><span class="o">.</span><span class="na">getDescriptors</span><span class="o">();</span>
                <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span> <span class="s">"read characteristic found : "</span> <span class="o">+</span> <span class="n">charaProp</span><span class="o">);</span>

                <span class="n">mBluetoothGatt</span><span class="o">.</span><span class="na">setCharacteristicNotification</span><span class="o">(</span><span class="n">gattCharacteristic</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
                <span class="c1">//리시버 설정</span>
                <span class="nc">BluetoothGattDescriptor</span> <span class="n">descriptor</span> <span class="o">=</span> <span class="n">mReadCharacteristic</span><span class="o">.</span><span class="na">getDescriptor</span><span class="o">(</span><span class="no">UUID</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="s">"00002902-0000-1000-8000-00805f9b34fb"</span><span class="o">));</span>
                <span class="n">descriptor</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="nc">BluetoothGattDescriptor</span><span class="o">.</span><span class="na">ENABLE_NOTIFICATION_VALUE</span><span class="o">);</span>
                <span class="n">mBluetoothGatt</span><span class="o">.</span><span class="na">writeDescriptor</span><span class="o">(</span><span class="n">descriptor</span><span class="o">);</span>
              <span class="o">}</span>
              <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
              <span class="o">}</span>
            <span class="o">}</span>
            <span class="k">else</span><span class="o">{</span>
              <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span> <span class="s">"read characteristic prop is invalid : "</span> <span class="o">+</span> <span class="n">charaProp</span><span class="o">);</span>
            <span class="o">}</span>
          <span class="o">}</span>
          <span class="k">else</span> <span class="nf">if</span><span class="o">(</span><span class="n">gattCharacteristic</span><span class="o">.</span><span class="na">getUuid</span><span class="o">().</span><span class="na">toString</span><span class="o">().</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="no">WRITE_UUID</span><span class="o">)){</span>
            <span class="kd">final</span> <span class="kt">int</span> <span class="n">charaProp</span> <span class="o">=</span> <span class="n">gattCharacteristic</span><span class="o">.</span><span class="na">getProperties</span><span class="o">();</span>

            <span class="k">if</span><span class="o">((</span><span class="n">charaProp</span> <span class="o">|</span> <span class="nc">BluetoothGattCharacteristic</span><span class="o">.</span><span class="na">PROPERTY_WRITE</span><span class="o">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">){</span>
              <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span> <span class="s">"write characteristic found : "</span> <span class="o">+</span> <span class="n">charaProp</span><span class="o">);</span>
              <span class="n">mWriteCharateristic</span> <span class="o">=</span> <span class="n">gattCharacteristic</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">else</span><span class="o">{</span>
              <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span> <span class="s">"write characteristic prop is invalid : "</span> <span class="o">+</span> <span class="n">charaProp</span><span class="o">);</span>
            <span class="o">}</span>
          <span class="o">}</span>
        <span class="o">}</span> 
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
  <span class="o">}</span>
</code></pre></div></div>

<p>BLE 기기는 특정 기능을 보유하고 있는 특성(Characteristic)과</p>

<p>그 특성들의 집합인 서비스(Service)로 구성되어 있다.</p>

<p>기기의 데이터를 읽고 쓰는 작업을 할 때도 이 특성들을 사용한다.</p>

<p>기기와 연결을 성공하면 해당 기기의 서비스와 특성들을 찾아</p>

<p>사용할수 있도록 등록해야 한다.</p>

<p>특성의 등록이 완료되면 기기 연결의 성공여부를</p>

<p>onConnectionStateChange() 메서드에서 받을 수 있다.</p>

<h3 id="4-ble-데이터-통신">4. BLE 데이터 통신</h3>

<p>연결이 성공하면 기기와 데이터를 주고받을 수 있다.</p>

<p>기기로 전송할 Command를 가공하여 실행하면 된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">writeData</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span><span class="o">){</span>
    <span class="k">try</span><span class="o">{</span>
        <span class="n">sendData</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="kt">boolean</span> <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">if</span><span class="o">(</span><span class="n">mBluetoothGatt</span><span class="o">.</span><span class="na">connect</span><span class="o">())</span>
        <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">mWriteCharateristic</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
                <span class="nc">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span> <span class="s">"Write gatt characteristic is null"</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">mReadCharacteristic</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
                <span class="nc">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span> <span class="s">"Read gatt characteristic is null"</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">dataLen</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>

                <span class="nc">String</span> <span class="n">sendDataG</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">data</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
                    <span class="n">sendDataG</span> <span class="o">+=</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%02x"</span><span class="o">,</span> <span class="n">data</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
                <span class="o">}</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"BLE Command 데이터 : "</span> <span class="o">+</span> <span class="n">sendDataG</span><span class="o">);</span>
                <span class="n">sendData</span> <span class="o">=</span> <span class="n">data</span><span class="o">;</span>

                <span class="nc">Handler</span> <span class="n">hd</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Handler</span><span class="o">();</span>
                <span class="n">hd</span><span class="o">.</span><span class="na">postDelayed</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                        <span class="n">mWriteCharateristic</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="n">sendData</span><span class="o">);</span>

                        <span class="k">if</span><span class="o">(</span><span class="n">mWriteCharateristic</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
                            <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"Ble UUID가 없습니다."</span><span class="o">,</span> <span class="s">""</span><span class="o">);</span>
                            <span class="n">mBluetoothGatt</span><span class="o">.</span><span class="na">disconnect</span><span class="o">();</span>
                        <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
                            <span class="n">mBluetoothGatt</span><span class="o">.</span><span class="na">writeCharacteristic</span><span class="o">(</span><span class="n">mWriteCharateristic</span><span class="o">);</span>
                        <span class="o">}</span>
                    <span class="o">}</span>
                <span class="o">},</span><span class="mi">5</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">else</span>
        <span class="o">{</span>
            <span class="nc">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span> <span class="s">"Bluetooth gatt is not connected"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="nc">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">""</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
</code></pre></div></div>

<p>기기에 Command를 전송하였을때 Response 데이터가 있다면</p>

<p>응답은 onCharacteristicChanged() 메서드로 콜백된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">final</span> <span class="nc">BluetoothGattCallback</span> <span class="n">mGattCallback</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BluetoothGattCallback</span><span class="o">()</span> <span class="o">{</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCharacteristicChanged</span><span class="o">(</span><span class="nc">BluetoothGatt</span> <span class="n">gatt</span><span class="o">,</span> <span class="nc">BluetoothGattCharacteristic</span> <span class="n">characteristic</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span>
    <span class="o">{</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">readByte</span> <span class="o">=</span> <span class="n">characteristic</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
        <span class="k">if</span><span class="o">(</span><span class="n">mBlelistner</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
          <span class="n">mBlelistner</span><span class="o">.</span><span class="na">recvData</span><span class="o">(</span><span class="n">readByte</span><span class="o">);</span> <span class="c1">// 기기 응답을 받는 리스너</span>
    <span class="o">}</span>
    <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>getValue() 값이 기기의 Response 데이터이다.</p>

<p>응답을 처리할 리스너를 등록하여 데이터를 처리한다.</p>

                </div>
            </section>
            
                
                <a href='/tag/javascript/'>JAVASCRIPT</a>,
                
            
                
                <a href='/tag/react/'>REACT</a>,
                
            
                
                <a href='/tag/node/'>NODE</a>,
                
            
                
                <a href='/tag/google/'>GOOGLE</a>,
                
            
                
                <a href='/tag/map/'>MAP</a>
                
            
            <!-- Email subscribe form at the bottom of the page -->
            <!--
            
                <section class="subscribe-form">
                    <h3 class="subscribe-form-title">Subscribe to SimpleHan Lab</h3>
                    <p>Get the latest posts delivered right to your inbox</p>
                    <span id="searchform" method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()"
               id="searchtext" type="text" name="searchtext"
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>
                </section>
            
            -->
            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/assets/built/images/author-logo.jpg" alt="Simplehan" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/Simplehan">Simplehan</a></h4>
                                
                                    <p>We are amazing developers.</p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/Simplehan">Read More</a>
                        </div>
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            
                <section class="post-full-comments">
                    <div id="disqus_thread"></div>
                    <script>
                        var disqus_config = function () {
                            var this_page_url = 'https://simplehanlab.github.io/ble';
                            var this_page_identifier = '/ble';
                            var this_page_title = '안드로이드 BLE 통신';
                        };
                        (function() {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://simplehanlab.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    </script>
                </section>
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/built/images/blog-cover1.png)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; SimpleHan Lab &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/javascript/">Javascript</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/react-native-base">React Native Base</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/android-project-structure">Android 프로젝트 구조</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/react-back-end">React back-end</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/javascript/">
                                
                                    See all 13 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/instagram-feed">
                <div class="post-card-image" style="background-image: url(/assets/built/images/react/react-logo.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/instagram-feed">
                <header class="post-card-header">
                    
                        
                            
                               <span class="post-card-tags">Javascript</span>
                            
                        
                            
                               <span class="post-card-tags">React</span>
                            
                        
                            
                               <span class="post-card-tags">Node</span>
                            
                        
                            
                               <span class="post-card-tags">Instagram</span>
                            
                        
                            
                                <span class="post-card-tags">Feed</span>
                            
                        
                    

                    <h2 class="post-card-title">인스타그램 최근 이미지 피드하기</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p>1. 인스타그램 피드하기

</p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/built/images/author-logo.jpg" alt="Simplehan" />
                        
                        <span class="post-card-author">
                            <a href="/author/Simplehan/">Simplehan</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/google-map-react2">
                <div class="post-card-image" style="background-image: url(/assets/built/images/react/react-logo.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/google-map-react2">
                <header class="post-card-header">
                    
                        
                            
                               <span class="post-card-tags">Javascript</span>
                            
                        
                            
                               <span class="post-card-tags">React</span>
                            
                        
                            
                               <span class="post-card-tags">Node</span>
                            
                        
                            
                               <span class="post-card-tags">Google</span>
                            
                        
                            
                                <span class="post-card-tags">Map</span>
                            
                        
                    

                    <h2 class="post-card-title">Google Map API React에서 사용하기 (2)</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p>1. 구글 맵 언어 설정

</p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/built/images/author-logo.jpg" alt="Simplehan" />
                        
                        <span class="post-card-author">
                            <a href="/author/Simplehan/">Simplehan</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://simplehanlab.github.io/">
            
            <span>SimpleHan Lab</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">안드로이드 BLE 통신</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C+BLE+%ED%86%B5%EC%8B%A0&amp;url=https://simplehanlab.github.io/ble"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://simplehanlab.github.io/ble"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        
        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://simplehanlab.github.io/">SimpleHan Lab</a> &copy; 2021</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyllt/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    
        <div id="subscribe" class="subscribe-overlay">
            <a class="subscribe-overlay-close" href="#"></a>
            <div class="subscribe-overlay-content">
                
                <h1 class="subscribe-overlay-title">Search SimpleHan Lab</h1>
                <p class="subscribe-overlay-description">
                    lunr.js를 이용한 posts 검색 </p>
                <span id="searchform" method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()"
               id="searchtext" type="text" name="searchtext"
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>
            </div>
        </div>
    


    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-xxxxxxxx-x', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
